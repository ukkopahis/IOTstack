
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Docker stack for getting started on IOT on the Raspberry PI">
      
      
      
      <link rel="icon" href="../stack-24.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.13">
    
    
      
        <title>Getting Started - IOTstack - UKKOPAHIS-fork</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../style.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IOTstack - UKKOPAHIS-fork" class="md-header__button md-logo" aria-label="IOTstack - UKKOPAHIS-fork" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.063 1.456a1.75 1.75 0 0 1 1.874 0l8.383 5.316a1.75 1.75 0 0 1 0 2.956l-8.383 5.316a1.75 1.75 0 0 1-1.874 0L2.68 9.728a1.75 1.75 0 0 1 0-2.956l8.383-5.316zm1.071 1.267a.25.25 0 0 0-.268 0L3.483 8.039a.25.25 0 0 0 0 .422l8.383 5.316a.25.25 0 0 0 .268 0l8.383-5.316a.25.25 0 0 0 0-.422l-8.383-5.316z"/><path fill-rule="evenodd" d="M1.867 12.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/><path fill-rule="evenodd" d="M1.867 16.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IOTstack - UKKOPAHIS-fork
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ukkopahis/IOTstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ukkopahis/IOTstack
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Basic setup
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Containers/AdGuardHome/" class="md-tabs__link">
        Containers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Developers/" class="md-tabs__link">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Updates/" class="md-tabs__link">
        Updates
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IOTstack - UKKOPAHIS-fork" class="md-nav__button md-logo" aria-label="IOTstack - UKKOPAHIS-fork" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.063 1.456a1.75 1.75 0 0 1 1.874 0l8.383 5.316a1.75 1.75 0 0 1 0 2.956l-8.383 5.316a1.75 1.75 0 0 1-1.874 0L2.68 9.728a1.75 1.75 0 0 1 0-2.956l8.383-5.316zm1.071 1.267a.25.25 0 0 0-.268 0L3.483 8.039a.25.25 0 0 0 0 .422l8.383 5.316a.25.25 0 0 0 .268 0l8.383-5.316a.25.25 0 0 0 0-.422l-8.383-5.316z"/><path fill-rule="evenodd" d="M1.867 12.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/><path fill-rule="evenodd" d="M1.867 16.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/></svg>

    </a>
    IOTstack - UKKOPAHIS-fork
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ukkopahis/IOTstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ukkopahis/IOTstack
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Basic setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basic setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Basic setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-installation" class="md-nav__link">
    New installation
  </a>
  
    <nav class="md-nav" aria-label="New installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-recommended" class="md-nav__link">
    automatic (recommended)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
    manual
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scripted" class="md-nav__link">
    scripted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-system-patches" class="md-nav__link">
    Required system patches
  </a>
  
    <nav class="md-nav" aria-label="Required system patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patch-1-restrict-dhcp" class="md-nav__link">
    patch 1 – restrict DHCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-2-update-libseccomp2" class="md-nav__link">
    patch 2 – update libseccomp2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-3-kernel-control-groups" class="md-nav__link">
    patch 3 - kernel control groups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-iotstack-menu" class="md-nav__link">
    the IOTstack menu
  </a>
  
    <nav class="md-nav" aria-label="the IOTstack menu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#menu-item-install-docker-old-menu-only" class="md-nav__link">
    menu item: Install Docker (old menu only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-build-stack" class="md-nav__link">
    menu item: Build Stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-docker-commands" class="md-nav__link">
    menu item: Docker commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-menu-items" class="md-nav__link">
    other menu items
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-menus" class="md-nav__link">
    switching menus
  </a>
  
    <nav class="md-nav" aria-label="switching menus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-menu-master-branch" class="md-nav__link">
    current menu (master branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-menu-old-menu-branch" class="md-nav__link">
    old menu (old-menu branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-branch" class="md-nav__link">
    experimental branch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands-docker-docker-compose" class="md-nav__link">
    useful commands: docker &amp; docker-compose
  </a>
  
    <nav class="md-nav" aria-label="useful commands: docker &amp; docker-compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-your-iotstack" class="md-nav__link">
    starting your IOTstack
  </a>
  
    <nav class="md-nav" aria-label="starting your IOTstack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging-journald-errors" class="md-nav__link">
    logging journald errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-an-individual-container" class="md-nav__link">
    starting an individual container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-your-iotstack" class="md-nav__link">
    stopping your IOTstack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-an-individual-container" class="md-nav__link">
    stopping an individual container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-container-status" class="md-nav__link">
    checking container status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-container-logs" class="md-nav__link">
    viewing container logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-container" class="md-nav__link">
    restarting a container
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistent-data" class="md-nav__link">
    persistent data
  </a>
  
    <nav class="md-nav" aria-label="persistent data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deleting-persistent-data" class="md-nav__link">
    deleting persistent data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack-maintenance" class="md-nav__link">
    stack maintenance
  </a>
  
    <nav class="md-nav" aria-label="stack maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-raspberry-pi-os" class="md-nav__link">
    update Raspberry Pi OS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-pull" class="md-nav__link">
    git pull
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-image-updates" class="md-nav__link">
    container image updates
  </a>
  
    <nav class="md-nav" aria-label="container image updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-images-not-built-from-dockerfiles" class="md-nav__link">
    updating images not built from Dockerfiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-images-built-from-dockerfiles" class="md-nav__link">
    updating images built from Dockerfiles
  </a>
  
    <nav class="md-nav" aria-label="updating images built from Dockerfiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-dockerfile-changes-local-image-only" class="md-nav__link">
    when Dockerfile changes (local image only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-dockerhub-updates-base-and-local-images" class="md-nav__link">
    when DockerHub updates (base and local images)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-unused-images" class="md-nav__link">
    deleting unused images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinning-to-specific-versions" class="md-nav__link">
    pinning to specific versions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Accessing-your-Device-from-the-internet/" class="md-nav__link">
        Accessing your device from the internet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Backup-and-Restore/" class="md-nav__link">
        Backing up and restoring IOTstack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Custom/" class="md-nav__link">
        Custom overrides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Default-Configs/" class="md-nav__link">
        Default Passwords and ports
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Menu/" class="md-nav__link">
        Menu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Understanding-Containers/" class="md-nav__link">
        What is Docker?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="What-is-sudo/" class="md-nav__link">
        What is sudo?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/AdGuardHome/" class="md-nav__link">
        AdGuard Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Adminer/" class="md-nav__link">
        Adminer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Blynk_server/" class="md-nav__link">
        Blynk server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Chronograf/" class="md-nav__link">
        Chronograf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/DashMachine/" class="md-nav__link">
        DashMachine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Deconz/" class="md-nav__link">
        deCONZ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/DiyHue/" class="md-nav__link">
        DIY hue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Dozzle/" class="md-nav__link">
        Dozzle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Duckdns/" class="md-nav__link">
        Duck DNS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/EspruinoHub/" class="md-nav__link">
        Espruinohub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Heimdall/" class="md-nav__link">
        Heimdall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Home-Assistant/" class="md-nav__link">
        Home Assistant
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Homebridge/" class="md-nav__link">
        Homebridge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Homer/" class="md-nav__link">
        Homer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/InfluxDB/" class="md-nav__link">
        InfluxDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/InfluxDB2/" class="md-nav__link">
        InfluxDB 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Kapacitor/" class="md-nav__link">
        Kapacitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MariaDB/" class="md-nav__link">
        MariaDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Mosquitto/" class="md-nav__link">
        Mosquitto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MotionEye/" class="md-nav__link">
        MotionEye
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/NextCloud/" class="md-nav__link">
        Nextcloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Node-RED/" class="md-nav__link">
        Node-RED
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Octoprint/" class="md-nav__link">
        Octoprint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/OpenHab/" class="md-nav__link">
        openHAB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Pi-hole/" class="md-nav__link">
        Pi-hole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Plex/" class="md-nav__link">
        Plex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-agent/" class="md-nav__link">
        Portainer agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-ce/" class="md-nav__link">
        Portainer CE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/PostgreSQL/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/RTL_433-docker/" class="md-nav__link">
        RTL_433 Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Syncthing/" class="md-nav__link">
        Syncthing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/TasmoAdmin/" class="md-nav__link">
        TasmoAdmin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Telegraf/" class="md-nav__link">
        Telegraf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Timescaledb/" class="md-nav__link">
        Timescaledb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/WireGuard/" class="md-nav__link">
        WireGuard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/X2go/" class="md-nav__link">
        x2go
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2MQTT/" class="md-nav__link">
        Zigbee2MQTT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2mqttassistant/" class="md-nav__link">
        Zigbee2Mqtt Assistant
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/BuildStack-RandomPassword/" class="md-nav__link">
        Build Stack Random Services Password
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/BuildStack-Services/" class="md-nav__link">
        Build Stack Services system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/Git-Setup/" class="md-nav__link">
        Git Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/Menu-System/" class="md-nav__link">
        Menu system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Developers/PostBuild-Script/" class="md-nav__link">
        Postbuild BASH Script
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Updates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Updates" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Updates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Updates/" class="md-nav__link">
        Updating the project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Updates/Changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Updates/New-Menu-Release-Notes/" class="md-nav__link">
        New IOTstack Menu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Updates/gcgarner-migration/" class="md-nav__link">
        Migrating from gcgarner to SensorsIot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Updates/migration-network-change/" class="md-nav__link">
        Migration: network change
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-installation" class="md-nav__link">
    New installation
  </a>
  
    <nav class="md-nav" aria-label="New installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-recommended" class="md-nav__link">
    automatic (recommended)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
    manual
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scripted" class="md-nav__link">
    scripted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-system-patches" class="md-nav__link">
    Required system patches
  </a>
  
    <nav class="md-nav" aria-label="Required system patches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patch-1-restrict-dhcp" class="md-nav__link">
    patch 1 – restrict DHCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-2-update-libseccomp2" class="md-nav__link">
    patch 2 – update libseccomp2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-3-kernel-control-groups" class="md-nav__link">
    patch 3 - kernel control groups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-iotstack-menu" class="md-nav__link">
    the IOTstack menu
  </a>
  
    <nav class="md-nav" aria-label="the IOTstack menu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#menu-item-install-docker-old-menu-only" class="md-nav__link">
    menu item: Install Docker (old menu only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-build-stack" class="md-nav__link">
    menu item: Build Stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-docker-commands" class="md-nav__link">
    menu item: Docker commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-menu-items" class="md-nav__link">
    other menu items
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-menus" class="md-nav__link">
    switching menus
  </a>
  
    <nav class="md-nav" aria-label="switching menus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-menu-master-branch" class="md-nav__link">
    current menu (master branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-menu-old-menu-branch" class="md-nav__link">
    old menu (old-menu branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-branch" class="md-nav__link">
    experimental branch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands-docker-docker-compose" class="md-nav__link">
    useful commands: docker &amp; docker-compose
  </a>
  
    <nav class="md-nav" aria-label="useful commands: docker &amp; docker-compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-your-iotstack" class="md-nav__link">
    starting your IOTstack
  </a>
  
    <nav class="md-nav" aria-label="starting your IOTstack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging-journald-errors" class="md-nav__link">
    logging journald errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-an-individual-container" class="md-nav__link">
    starting an individual container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-your-iotstack" class="md-nav__link">
    stopping your IOTstack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-an-individual-container" class="md-nav__link">
    stopping an individual container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-container-status" class="md-nav__link">
    checking container status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-container-logs" class="md-nav__link">
    viewing container logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-container" class="md-nav__link">
    restarting a container
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistent-data" class="md-nav__link">
    persistent data
  </a>
  
    <nav class="md-nav" aria-label="persistent data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deleting-persistent-data" class="md-nav__link">
    deleting persistent data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack-maintenance" class="md-nav__link">
    stack maintenance
  </a>
  
    <nav class="md-nav" aria-label="stack maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-raspberry-pi-os" class="md-nav__link">
    update Raspberry Pi OS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-pull" class="md-nav__link">
    git pull
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-image-updates" class="md-nav__link">
    container image updates
  </a>
  
    <nav class="md-nav" aria-label="container image updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-images-not-built-from-dockerfiles" class="md-nav__link">
    updating images not built from Dockerfiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-images-built-from-dockerfiles" class="md-nav__link">
    updating images built from Dockerfiles
  </a>
  
    <nav class="md-nav" aria-label="updating images built from Dockerfiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-dockerfile-changes-local-image-only" class="md-nav__link">
    when Dockerfile changes (local image only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-dockerhub-updates-base-and-local-images" class="md-nav__link">
    when DockerHub updates (base and local images)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-unused-images" class="md-nav__link">
    deleting unused images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinning-to-specific-versions" class="md-nav__link">
    pinning to specific versions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ukkopahis/IOTstack/edit/master/docs/Basic_setup/index.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>IOTstack makes the following assumptions:</p>
<ol>
<li>
<p>Your hardware is a Raspberry Pi (typically a 3B+ or 4B).</p>
<ul>
<li>The Raspberry Pi Zero W2 has been tested with IOTstack. It works but the 512MB RAM means you should not try to run too many containers concurrently.</li>
<li>Users have also <a href="https://github.com/SensorsIot/IOTstack/issues/375">reported success</a> on Orange Pi
  Win/Plus.</li>
<li>Most services will run on any Linux machine with Docker, but some have
  Raspberry Pi specific default configurations or dependencies.</li>
</ul>
</li>
<li>
<p>Your Raspberry Pi has a reasonably-recent version of 32-bit or 64-bit Raspberry Pi OS (aka "Raspbian") installed. You can download operating-system images:</p>
<ul>
<li><a href="https://www.raspberrypi.com/software/operating-systems/">Current release</a>
  : "Raspberry Pi OS with desktop" is recommended.</li>
<li><a href="http://downloads.raspberrypi.org/raspios_armhf/images/">Prior releases</a>
  : This offers only "Raspberry Pi OS with desktop" images.</li>
</ul>
</li>
<li>
<p>You've done a "default" Raspberry Pi OS install, which automatically
   satisfies:</p>
<ul>
<li>you log in as a regular user, not root. The actual username and its
  numeric uid doesn't matter.</li>
<li>this user has <code>sudo</code>-access, usually this is done by belonging to the
  <em>sudo</em>-group.</li>
<li>boot partition is mounted at <code>/boot</code>.</li>
</ul>
</li>
<li>
<p>Your operating system has been updated:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt update
<span class="gp">$ </span>sudo apt upgrade -y
</code></pre></div>
</li>
</ol>
<p>For brevity, this documentation also makes some guesses, but these aren't
technical requirements. If you have a different choice, you'll just have to
adjust the commands presented in these instructions to match the change. For
first-time Linux users it's recommended to start with these:</p>
<ul>
<li>You are logged-in as the user "pi".</li>
<li>The home directory for user "pi" is <code>/home/pi/</code>.</li>
<li>IOTstack is installed at <code>~/IOTstack</code> (with that exact spelling).</li>
<li>The system hostname is <code>raspberrypi</code></li>
</ul>
<h2 id="new-installation">New installation<a class="headerlink" href="#new-installation" title="Permanent link">&para;</a></h2>
<h3 id="automatic-recommended">automatic (recommended)<a class="headerlink" href="#automatic-recommended" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Install <code>curl</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt install -y curl
</code></pre></div>
</li>
<li>
<p>Run the following command:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>curl -fsSL https://raw.githubusercontent.com/SensorsIot/IOTstack/master/install.sh <span class="p">|</span> bash
</code></pre></div>
</li>
<li>
<p>Run the menu and choose your containers:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>./menu.sh
</code></pre></div>
</li>
<li>
<p>Bring up your stack:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d
</code></pre></div>
</li>
</ol>
<h3 id="manual">manual<a class="headerlink" href="#manual" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Install <code>git</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt install -y git
</code></pre></div>
</li>
<li>
<p>Clone IOTstack:</p>
<ul>
<li>
<p>If you want "new menu":</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>git clone https://github.com/SensorsIot/IOTstack.git ~/IOTstack
</code></pre></div>
</li>
<li>
<p>If you prefer "old menu":</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>git clone -b old-menu https://github.com/SensorsIot/IOTstack.git ~/IOTstack
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Run the menu and choose your containers:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>./menu.sh
</code></pre></div>
<p>Note:</p>
<ul>
<li>If you are running "old menu" for the first time, you will be guided to "Install Docker". That will end in a reboot, after which you should re-enter the menu and choose your containers.</li>
</ul>
</li>
<li>
<p>Bring up your stack:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d
</code></pre></div>
</li>
</ol>
<h3 id="scripted">scripted<a class="headerlink" href="#scripted" title="Permanent link">&para;</a></h3>
<p>If you prefer to automate your installations using scripts, see
<a href="https://github.com/Paraphraser/PiBuilder">PiBuilder</a>.</p>
<h2 id="required-system-patches">Required system patches<a class="headerlink" href="#required-system-patches" title="Permanent link">&para;</a></h2>
<p>Unless you know what you are doing, assume these are needed.</p>
<h3 id="patch-1-restrict-dhcp">patch 1 – restrict DHCP<a class="headerlink" href="#patch-1-restrict-dhcp" title="Permanent link">&para;</a></h3>
<p>Run the following commands:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo bash -c <span class="s1">&#39;[ $(egrep -c &quot;^allowinterfaces eth\*,wlan\*&quot; /etc/dhcpcd.conf) -eq 0 ] &amp;&amp; echo &quot;allowinterfaces eth*,wlan*&quot; &gt;&gt; /etc/dhcpcd.conf&#39;</span>
</code></pre></div>
<p>See <a href="https://github.com/SensorsIot/IOTstack/issues/219">Issue 219</a> and <a href="https://github.com/SensorsIot/IOTstack/issues/253">Issue 253</a> for more information.</p>
<h3 id="patch-2-update-libseccomp2">patch 2 – update libseccomp2<a class="headerlink" href="#patch-2-update-libseccomp2" title="Permanent link">&para;</a></h3>
<p>This patch is <strong>ONLY</strong> for Raspbian Buster. Do <strong>NOT</strong> install this patch if you are running Raspbian Bullseye.</p>
<ol>
<li>
<p>check your OS release</p>
<p>Run the following command:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>grep <span class="s2">&quot;PRETTY_NAME&quot;</span> /etc/os-release
<span class="go">PRETTY_NAME=&quot;Raspbian GNU/Linux 10 (buster)&quot;</span>
</code></pre></div>
<p>If you see the word "buster", proceed to step 2. Otherwise, skip this patch.</p>
</li>
<li>
<p>if you are indeed running "buster"</p>
<p>Without this patch on Buster, Docker images will fail if:</p>
<ul>
<li>the image is based on Alpine and the image's maintainer updates to <a href="https://wiki.alpinelinux.org/wiki/Release_Notes_for_Alpine_3.13.0#time64_requirement">Alpine 3.13</a>; and/or</li>
<li>an image's maintainer updates to a library that depends on 64-bit values for <em>Unix epoch time</em> (the so-called Y2038 problem).</li>
</ul>
<p>To install the patch:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt-key adv --keyserver hkps://keyserver.ubuntu.com:443 --recv-keys 04EE7237B7D453EC 648ACFD622F3D138
<span class="gp">$ </span><span class="nb">echo</span> <span class="s2">&quot;deb http://httpredir.debian.org/debian buster-backports main contrib non-free&quot;</span> <span class="p">|</span> sudo tee -a <span class="s2">&quot;/etc/apt/sources.list.d/debian-backports.list&quot;</span>
<span class="gp">$ </span>sudo apt update
<span class="gp">$ </span>sudo apt install libseccomp2 -t buster-backports
</code></pre></div>
</li>
</ol>
<h3 id="patch-3-kernel-control-groups">patch 3 - kernel control groups<a class="headerlink" href="#patch-3-kernel-control-groups" title="Permanent link">&para;</a></h3>
<p>Kernel control groups need to be enabled in order to monitor container specific
usage. This makes commands like <code>docker stats</code> fully work. Also needed for full
monitoring of docker resource usage by the telegraf container.</p>
<p>Enable by running (takes effect after reboot):</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">echo</span> <span class="k">$(</span>cat /boot/cmdline.txt<span class="k">)</span> <span class="nv">cgroup_memory</span><span class="o">=</span><span class="m">1</span> <span class="nv">cgroup_enable</span><span class="o">=</span>memory <span class="p">|</span> sudo tee /boot/cmdline.txt
<span class="gp">$ </span>sudo reboot
</code></pre></div>
<h2 id="the-iotstack-menu">the IOTstack menu<a class="headerlink" href="#the-iotstack-menu" title="Permanent link">&para;</a></h2>
<p>The menu is used to install Docker and then build the <code>docker-compose.yml</code> file which is necessary for starting the stack.</p>
<blockquote>
<p>The menu is only an aid. It is a good idea to learn the <code>docker</code> and <code>docker-compose</code> commands if you plan on using Docker in the long run.</p>
</blockquote>
<h3 id="menu-item-install-docker-old-menu-only">menu item: Install Docker (old menu only)<a class="headerlink" href="#menu-item-install-docker-old-menu-only" title="Permanent link">&para;</a></h3>
<p>Please do <strong>not</strong> try to install <code>docker</code> and <code>docker-compose</code> via <code>sudo apt install</code>. There's more to it than that. Docker needs to be installed by <code>menu.sh</code>. The menu will prompt you to install docker if it detects that docker is not already installed. You can manually install it from within the <code>Native Installs</code> menu:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>./menu.sh
<span class="go">Select &quot;Native Installs&quot;</span>
<span class="go">Select &quot;Install Docker and Docker-Compose&quot;</span>
</code></pre></div>
<p>Follow the prompts. The process finishes by asking you to reboot. Do that!</p>
<p>Note:</p>
<ul>
<li>New menu (master branch) automates this step.</li>
</ul>
<h3 id="menu-item-build-stack">menu item: Build Stack<a class="headerlink" href="#menu-item-build-stack" title="Permanent link">&para;</a></h3>
<p><code>docker-compose</code> uses a <code>docker-compose.yml</code> file to configure all your services. The <code>docker-compose.yml</code> file is created by the menu:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>./menu.sh
<span class="go">Select &quot;Build Stack&quot;</span>
</code></pre></div>
<p>Follow the on-screen prompts and select the containers you need.</p>
<blockquote>
<p>The best advice we can give is "start small". Limit yourself to the core containers you actually need (eg Mosquitto, Node-RED, InfluxDB, Grafana, Portainer). You can always add more containers later. Some users have gone overboard with their initial selections and have run into what seem to be Raspberry Pi OS limitations.</p>
</blockquote>
<p>Key point:</p>
<ul>
<li>If you are running "new menu" (master branch) and you select Node-RED, you <strong>must</strong> press the right-arrow and choose at least one add-on node. If you skip this step, Node-RED will not build properly.</li>
<li>Old menu forces you to choose add-on nodes for Node-RED.</li>
</ul>
<p>The process finishes by asking you to bring up the stack:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d
</code></pre></div>
<p>The first time you run <code>up</code> the stack docker will download all the images from DockerHub. How long this takes will depend on how many containers you selected and the speed of your internet connection.</p>
<p>Some containers also need to be built locally. Node-RED is an example. Depending on the Node-RED nodes you select, building the image can also take a very long time. This is especially true if you select the SQLite node.</p>
<p>Be patient (and ignore the huge number of warnings).</p>
<h3 id="menu-item-docker-commands">menu item: Docker commands<a class="headerlink" href="#menu-item-docker-commands" title="Permanent link">&para;</a></h3>
<p>The commands in this menu execute shell scripts in the root of the project.</p>
<h3 id="other-menu-items">other menu items<a class="headerlink" href="#other-menu-items" title="Permanent link">&para;</a></h3>
<p>The old and new menus differ in the options they offer. You should come back and explore them once your stack is built and running.</p>
<h2 id="switching-menus">switching menus<a class="headerlink" href="#switching-menus" title="Permanent link">&para;</a></h2>
<p>At the time of writing, IOTstack supports three menus:</p>
<ul>
<li>"Old Menu" on the <code>old-menu</code> branch. This was inherited from <a href="https://github.com/gcgarner/IOTstack">gcgarner/IOTstack</a>.</li>
<li>"New Menu" on the <code>master</code> branch. This is the current menu.</li>
<li>"New New Menu" on the <code>experimental</code> branch. This is under development.</li>
</ul>
<p>With a few precautions, you can switch between git branches as much as you like without breaking anything. The basic check you should perform is:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>git status
</code></pre></div>
<p>Check the results to see if any files are marked as "modified". For example:</p>
<div class="language-output highlight"><pre><span></span><code><span class="go">modified:   .templates/mosquitto/Dockerfile</span>
</code></pre></div>
<p>Key point:</p>
<ul>
<li>Files marked "untracked" do not matter. You only need to check for "modified" files because those have the potential to stop you from switching branches cleanly.</li>
</ul>
<p>The way to avoid potential problems is to move any modified files to one side and restore the unmodified original. For example:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>mv .templates/mosquitto/Dockerfile .templates/mosquitto/Dockerfile.save
<span class="gp">$ </span>git checkout -- .templates/mosquitto/Dockerfile
</code></pre></div>
<p>When <code>git status</code> reports no more "modified" files, it is safe to switch your branch.</p>
<h3 id="current-menu-master-branch">current menu (master branch)<a class="headerlink" href="#current-menu-master-branch" title="Permanent link">&para;</a></h3>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack/
<span class="gp">$ </span>git pull
<span class="gp">$ </span>git checkout master
<span class="gp">$ </span>./menu.sh
</code></pre></div>
<h3 id="old-menu-old-menu-branch">old menu (old-menu branch)<a class="headerlink" href="#old-menu-old-menu-branch" title="Permanent link">&para;</a></h3>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack/
<span class="gp">$ </span>git pull
<span class="gp">$ </span>git checkout old-menu
<span class="gp">$ </span>./menu.sh
</code></pre></div>
<h3 id="experimental-branch">experimental branch<a class="headerlink" href="#experimental-branch" title="Permanent link">&para;</a></h3>
<p>Switch to the experimental branch to try the latest and greatest features.</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack/
<span class="gp">$ </span>git pull
<span class="gp">$ </span>git checkout experimental
<span class="gp">$ </span>./menu.sh
</code></pre></div>
<p>Notes:</p>
<ul>
<li>Please make sure you have a good backup before you start.</li>
<li>The experimental branch may be broken, or may break your setup.</li>
<li>Please report any issues.</li>
<li>
<p>Remember:</p>
<ul>
<li>you can switch git branches as much as you like without breaking anything.</li>
<li>simply launching the menu (any version) won't change anything providing you exit before letting the menu complete.</li>
<li>running the menu <em>to completion</em> <strong>will</strong> change your docker-compose.yml and supporting structures in <code>~/IOTstack/services</code>.</li>
<li>running <code>docker-compose up -d</code> will change your running containers.</li>
</ul>
</li>
<li>
<p>The way back is to take down your stack, restore a backup, and bring up your stack again.</p>
</li>
</ul>
<h2 id="useful-commands-docker-docker-compose">useful commands: docker &amp; docker-compose<a class="headerlink" href="#useful-commands-docker-docker-compose" title="Permanent link">&para;</a></h2>
<p>Handy rules:</p>
<ul>
<li><code>docker</code> commands can be executed from anywhere, but</li>
<li><code>docker-compose</code> commands need to be executed from within <code>~/IOTstack</code></li>
</ul>
<h3 id="starting-your-iotstack">starting your IOTstack<a class="headerlink" href="#starting-your-iotstack" title="Permanent link">&para;</a></h3>
<p>To start the stack:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d
</code></pre></div>
<p>Once the stack has been brought up, it will stay up until you take it down. This includes shutdowns and reboots of your Raspberry Pi. If you do not want the stack to start automatically after a reboot, you need to stop the stack before you issue the reboot command.</p>
<h4 id="logging-journald-errors">logging journald errors<a class="headerlink" href="#logging-journald-errors" title="Permanent link">&para;</a></h4>
<p>If you get docker logging error like:</p>
<div class="language-text highlight"><pre><span></span><code>Cannot create container for service [service name here]: unknown log opt &#39;max-file&#39; for journald log driver
</code></pre></div>
<ol>
<li>
<p>Run the command:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo nano /etc/docker/daemon.json
</code></pre></div>
</li>
<li>
<p>change:</p>
<div class="language-json highlight"><pre><span></span><code><span class="nt">&quot;log-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;journald&quot;</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>to:</p>
<div class="language-json highlight"><pre><span></span><code><span class="nt">&quot;log-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-file&quot;</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
</li>
</ol>
<p>Logging limits were added to prevent Docker using up lots of RAM if log2ram is enabled, or SD cards being filled with log data and degraded from unnecessary IO. See <a href="https://docs.docker.com/config/containers/logging/configure/">Docker Logging configurations</a></p>
<p>You can also turn logging off or set it to use another option for any service by using the IOTstack <code>docker-compose-override.yml</code> file mentioned at <a href="Custom/">IOTstack/Custom</a>.</p>
<h3 id="starting-an-individual-container">starting an individual container<a class="headerlink" href="#starting-an-individual-container" title="Permanent link">&para;</a></h3>
<p>To start a particular container:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d «container»
</code></pre></div>
<h3 id="stopping-your-iotstack">stopping your IOTstack<a class="headerlink" href="#stopping-your-iotstack" title="Permanent link">&para;</a></h3>
<p>Stopping aka "downing" the stack stops and deletes all containers, and removes the internal network:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose down
</code></pre></div>
<p>To stop the stack without removing containers, run:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose stop
</code></pre></div>
<h3 id="stopping-an-individual-container">stopping an individual container<a class="headerlink" href="#stopping-an-individual-container" title="Permanent link">&para;</a></h3>
<p><code>stop</code> can also be used to stop individual containers, like this:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose stop «container»
</code></pre></div>
<p>This puts the container in a kind of suspended animation. You can resume the container with</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose start «container»
</code></pre></div>
<p>There is no equivalent of <code>down</code> for a single container. It needs:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose rm --force --stop -v «container»
</code></pre></div>
<p>To reactivate a container which has been stopped and removed:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d «container»
</code></pre></div>
<h3 id="checking-container-status">checking container status<a class="headerlink" href="#checking-container-status" title="Permanent link">&para;</a></h3>
<p>You can check the status of containers with:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker ps
</code></pre></div>
<p>or</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose ps
</code></pre></div>
<h3 id="viewing-container-logs">viewing container logs<a class="headerlink" href="#viewing-container-logs" title="Permanent link">&para;</a></h3>
<p>You can inspect the logs of most containers like this:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker logs «container»
</code></pre></div>
<p>for example:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker logs nodered
</code></pre></div>
<p>You can also follow a container's log as new entries are added by using the <code>-f</code> flag:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker logs -f nodered
</code></pre></div>
<p>Terminate with a Control+C. Note that restarting a container will also terminate a followed log.</p>
<h3 id="restarting-a-container">restarting a container<a class="headerlink" href="#restarting-a-container" title="Permanent link">&para;</a></h3>
<p>You can restart a container in several ways:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose restart «container»
</code></pre></div>
<p>This kind of restart is the least-powerful form of restart. A good way to think of it is "the container is only restarted, it is not rebuilt".</p>
<p>If you change a <code>docker-compose.yml</code> setting for a container and/or an environment variable file referenced by <code>docker-compose.yml</code> then a <code>restart</code> is usually not enough to bring the change into effect. You need to make <code>docker-compose</code> notice the change:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d «container»
</code></pre></div>
<p>This type of "restart" rebuilds the container.</p>
<p>Alternatively, to force a container to rebuild (without changing either <code>docker-compose.yml</code> or an environment variable file):</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d --force-recreate «container»
</code></pre></div>
<p>See also <a href="#updating-images-not-built-from-dockerfiles">updating images built from Dockerfiles</a> if you need to force <code>docker-compose</code> to notice a change to a Dockerfile.</p>
<h2 id="persistent-data">persistent data<a class="headerlink" href="#persistent-data" title="Permanent link">&para;</a></h2>
<p>Docker allows a container's designer to map folders inside a container to a folder on your disk (SD, SSD, HD). This is done with the "volumes" key in <code>docker-compose.yml</code>. Consider the following snippet for Node-RED:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/nodered/data:/data</span><span class="w"></span>
</code></pre></div>
<p>You read this as two paths, separated by a colon. The:</p>
<ul>
<li>external path is <code>./volumes/nodered/data</code></li>
<li>internal path is <code>/data</code></li>
</ul>
<p>In this context, the leading "." means "the folder containing<code>docker-compose.yml</code>", so the external path is actually:</p>
<ul>
<li><code>~/IOTstack/volumes/nodered/data</code></li>
</ul>
<p>This type of volume is a
<a href="https://docs.docker.com/storage/bind-mounts/">bind-mount</a>, where the
container's internal path is directly linked to the external path. All
file-system operations, reads and writes, are mapped to directly to the files
and folders at the external path.</p>
<h3 id="deleting-persistent-data">deleting persistent data<a class="headerlink" href="#deleting-persistent-data" title="Permanent link">&para;</a></h3>
<p>If you need a "clean slate" for a container, you can delete its volumes. Using InfluxDB as an example:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose rm --force --stop -v influxdb
<span class="gp">$ </span>sudo rm -rf ./volumes/influxdb
<span class="gp">$ </span>docker-compose up -d influxdb
</code></pre></div>
<p>When <code>docker-compose</code> tries to bring up InfluxDB, it will notice this volume mapping in <code>docker-compose.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/influxdb/data:/var/lib/influxdb</span><span class="w"></span>
</code></pre></div>
<p>and check to see whether <code>./volumes/influxdb/data</code> is present. Finding it not there, it does the equivalent of:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo mkdir -p ./volumes/influxdb/data
</code></pre></div>
<p>When InfluxDB starts, it sees that the folder on right-hand-side of the volumes mapping (<code>/var/lib/influxdb</code>) is empty and initialises new databases.</p>
<p>This is how <strong>most</strong> containers behave. There are exceptions so it's always a good idea to keep a backup.</p>
<h2 id="stack-maintenance">stack maintenance<a class="headerlink" href="#stack-maintenance" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Breaking update</p>
<p>Recent changes will require <a href="../Updates/migration-network-change/">manual steps</a>
or you may get an error like:<br />
<code>ERROR: Service "influxdb" uses an undefined network "iotstack_nw"</code></p>
</div>
<h3 id="update-raspberry-pi-os">update Raspberry Pi OS<a class="headerlink" href="#update-raspberry-pi-os" title="Permanent link">&para;</a></h3>
<p>You should keep your Raspberry Pi up-to-date. Despite the word "container" suggesting that <em>containers</em> are fully self-contained, they sometimes depend on operating system components ("WireGuard" is an example).</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>sudo apt update
<span class="gp">$ </span>sudo apt upgrade -y
</code></pre></div>
<h3 id="git-pull">git pull<a class="headerlink" href="#git-pull" title="Permanent link">&para;</a></h3>
<p>Although the menu will generally do this for you, it does not hurt to keep your local copy of the IOTstack repository in sync with the master version on GitHub.</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>git pull
</code></pre></div>
<h3 id="container-image-updates">container image updates<a class="headerlink" href="#container-image-updates" title="Permanent link">&para;</a></h3>
<p>There are two kinds of images used in IOTstack:</p>
<ul>
<li>Those not built using Dockerfiles (the majority)</li>
<li>
<p>Those built using Dockerfiles (special cases)</p>
<blockquote>
<p>A Dockerfile is a set of instructions designed to customise an image before it is instantiated to become a running container.</p>
</blockquote>
</li>
</ul>
<p>The easiest way to work out which type of image you are looking at is to inspect the container's service definition in your <code>docker-compose.yml</code> file. If the service definition contains the:</p>
<ul>
<li><code>image:</code> keyword then the image is <strong>not</strong> built using a Dockerfile.</li>
<li><code>build:</code> keyword then the image <strong>is</strong> built using a Dockerfile.</li>
</ul>
<h4 id="updating-images-not-built-from-dockerfiles">updating images not built from Dockerfiles<a class="headerlink" href="#updating-images-not-built-from-dockerfiles" title="Permanent link">&para;</a></h4>
<p>If new versions of this type of image become available on DockerHub, your local IOTstack copies can be updated by a <code>pull</code> command:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose pull
<span class="gp">$ </span>docker-compose up -d
<span class="gp">$ </span>docker system prune
</code></pre></div>
<p>The <code>pull</code> downloads any new images. It does this without disrupting the running stack.</p>
<p>The <code>up -d</code> notices any newly-downloaded images, builds new containers, and swaps old-for-new. There is barely any downtime for affected containers.</p>
<h4 id="updating-images-built-from-dockerfiles">updating images built from Dockerfiles<a class="headerlink" href="#updating-images-built-from-dockerfiles" title="Permanent link">&para;</a></h4>
<p>Containers built using Dockerfiles have a two-step process:</p>
<ol>
<li>A <em>base</em> image is downloaded from from DockerHub; and then</li>
<li>The Dockerfile "runs" to build a <em>local</em> image.</li>
</ol>
<p>Node-RED is a good example of a container built from a Dockerfile. The Dockerfile defines some (or possibly all) of your add-on nodes, such as those needed for InfluxDB or Tasmota.</p>
<p>There are two separate update situations that you need to consider:</p>
<ul>
<li>If your Dockerfile changes; or</li>
<li>If a newer base image appears on DockerHub</li>
</ul>
<p>Node-RED also provides a good example of why your Dockerfile might change: if you decide to add or remove add-on nodes.</p>
<p>Note:</p>
<ul>
<li>You can also add nodes to Node-RED using Manage Palette.</li>
</ul>
<h5 id="when-dockerfile-changes-local-image-only">when Dockerfile changes (<em>local</em> image only)<a class="headerlink" href="#when-dockerfile-changes-local-image-only" title="Permanent link">&para;</a></h5>
<p>When your Dockerfile changes, you need to rebuild like this:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up --build -d «container»
<span class="gp">$ </span>docker system prune
</code></pre></div>
<p>This only rebuilds the <em>local</em> image and, even then, only if <code>docker-compose</code> senses a <em>material</em> change to the Dockerfile.</p>
<p>If you are trying to force the inclusion of a later version of an add-on node, you need to treat it like a <a href="#updating-images-built-from-dockerfiles">DockerHub update</a>.</p>
<p>Key point:</p>
<ul>
<li>The <em>base</em> image is not affected by this type of update.</li>
</ul>
<p>Note:</p>
<ul>
<li>
<p>You can also use this type of build if you get an error after modifying Node-RED's environment:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up --build -d nodered
</code></pre></div>
</li>
</ul>
<h5 id="when-dockerhub-updates-base-and-local-images">when DockerHub updates (<em>base</em> and <em>local</em> images)<a class="headerlink" href="#when-dockerhub-updates-base-and-local-images" title="Permanent link">&para;</a></h5>
<p>When a newer version of the <em>base</em> image appears on DockerHub, you need to rebuild like this:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose build --no-cache --pull «container»
<span class="gp">$ </span>docker-compose up -d «container»
<span class="gp">$ </span>docker system prune
<span class="gp">$ </span>docker system prune
</code></pre></div>
<p>This causes DockerHub to be checked for the later version of the <em>base</em> image, downloading it as needed.</p>
<p>Then, the Dockerfile is run to produce a new <em>local</em> image. The Dockerfile run happens even if a new <em>base</em> image was not downloaded in the previous step.</p>
<h3 id="deleting-unused-images">deleting unused images<a class="headerlink" href="#deleting-unused-images" title="Permanent link">&para;</a></h3>
<p>As your system evolves and new images come down from DockerHub, you may find that more disk space is being occupied than you expected. Try running:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker system prune
</code></pre></div>
<p>This recovers anything no longer in use. Sometimes multiple <code>prune</code> commands are needed (eg the first removes an old <em>local</em> image, the second removes the old <em>base</em> image).</p>
<p>If you add a container via <code>menu.sh</code> and later remove it (either manually or via <code>menu.sh</code>), the associated images(s) will probably persist. You can check which images are installed via:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker images

<span class="go">REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE</span>
<span class="go">influxdb                 latest              1361b14bf545        5 days ago          264MB</span>
<span class="go">grafana/grafana          latest              b9dfd6bb8484        13 days ago         149MB</span>
<span class="go">iotstack_nodered         latest              21d5a6b7b57b        2 weeks ago         540MB</span>
<span class="go">portainer/portainer-ce   latest              5526251cc61f        5 weeks ago         163MB</span>
<span class="go">eclipse-mosquitto        latest              4af162db6b4c        6 weeks ago         8.65MB</span>
<span class="go">nodered/node-red         latest              fa3bc6f20464        2 months ago        376MB</span>
<span class="go">portainer/portainer      latest              dbf28ba50432        2 months ago        62.5MB</span>
</code></pre></div>
<p>Both "Portainer CE" and "Portainer" are in that list. Assuming "Portainer" is no longer in use, it can be removed by using either its repository name or its Image ID. In other words, the following two commands are synonyms:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker rmi portainer/portainer
<span class="gp">$ </span>docker rmi dbf28ba50432
</code></pre></div>
<p>In general, you can use the repository name to remove an image but the Image ID is sometimes needed. The most common situation where you are likely to need the Image ID is after an image has been updated on DockerHub and pulled down to your Raspberry Pi. You will find two containers with the same name. One will be tagged "latest" (the running version) while the other will be tagged "\&lt;none>" (the prior version). You use the Image ID to resolve the ambiguity.</p>
<h3 id="pinning-to-specific-versions">pinning to specific versions<a class="headerlink" href="#pinning-to-specific-versions" title="Permanent link">&para;</a></h3>
<p>See <a href="#container-image-updates">container image updates</a> to understand how to tell the difference between images that are used "as is" from DockerHub versus those that are built from local Dockerfiles.</p>
<p>Note:</p>
<ul>
<li>You should <strong>always</strong> visit an image's DockerHub page before pinning to a specific version. This is the only way to be certain that you are choosing the appropriate version suffix.</li>
</ul>
<p>To pin an image to a specific version:</p>
<ul>
<li>
<p>If the image comes straight from DockerHub, you apply the pin in <code>docker-compose.yml</code>. For example, to pin Grafana to version 7.5.7, you change:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:latest</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">…</span><span class="w"></span>
</code></pre></div>
<p>to:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:7.5.7</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">…</span><span class="w"></span>
</code></pre></div>
<p>To apply the change, "up" the container:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d grafana
</code></pre></div>
</li>
<li>
<p>If the image is built using a local Dockerfile, you apply the pin in the Dockerfile. For example, to pin Mosquitto to version 1.6.15, edit <code>~/IOTstack/.templates/mosquitto/Dockerfile</code> to change:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span class="c"># Download base image</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">eclipse-mosquitto:latest</span>
…
</code></pre></div>
<p>to:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span class="c"># Download base image</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">eclipse-mosquitto:1.6.15</span>
…
</code></pre></div>
<p>To apply the change, "up" the container and pass the <code>--build</code> flag:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/IOTstack
<span class="gp">$ </span>docker-compose up -d --build mosquitto
</code></pre></div>
</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="Accessing-your-Device-from-the-internet/" class="md-footer__link md-footer__link--next" aria-label="Next: Accessing your device from the internet" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Accessing your device from the internet
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "tabs", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="../javascript/fix-codeblock-console-copy-button.js"></script>
      
    
  </body>
</html>