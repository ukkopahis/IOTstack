
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Docker stack for getting started on IOT on the Raspberry PI">
      
      
      
      <link rel="icon" href="../../stack-24.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.13">
    
    
      
        <title>InfluxDB 2 - IOTstack - UKKOPAHIS-fork</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../style.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#influxdb-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="IOTstack - UKKOPAHIS-fork" class="md-header__button md-logo" aria-label="IOTstack - UKKOPAHIS-fork" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.063 1.456a1.75 1.75 0 0 1 1.874 0l8.383 5.316a1.75 1.75 0 0 1 0 2.956l-8.383 5.316a1.75 1.75 0 0 1-1.874 0L2.68 9.728a1.75 1.75 0 0 1 0-2.956l8.383-5.316zm1.071 1.267a.25.25 0 0 0-.268 0L3.483 8.039a.25.25 0 0 0 0 .422l8.383 5.316a.25.25 0 0 0 .268 0l8.383-5.316a.25.25 0 0 0 0-.422l-8.383-5.316z"/><path fill-rule="evenodd" d="M1.867 12.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/><path fill-rule="evenodd" d="M1.867 16.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IOTstack - UKKOPAHIS-fork
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              InfluxDB 2
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ukkopahis/IOTstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ukkopahis/IOTstack
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Basic_setup/" class="md-tabs__link">
        Basic setup
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../AdGuardHome/" class="md-tabs__link md-tabs__link--active">
        Containers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Developers/" class="md-tabs__link">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Updates/" class="md-tabs__link">
        Updates
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IOTstack - UKKOPAHIS-fork" class="md-nav__button md-logo" aria-label="IOTstack - UKKOPAHIS-fork" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.063 1.456a1.75 1.75 0 0 1 1.874 0l8.383 5.316a1.75 1.75 0 0 1 0 2.956l-8.383 5.316a1.75 1.75 0 0 1-1.874 0L2.68 9.728a1.75 1.75 0 0 1 0-2.956l8.383-5.316zm1.071 1.267a.25.25 0 0 0-.268 0L3.483 8.039a.25.25 0 0 0 0 .422l8.383 5.316a.25.25 0 0 0 .268 0l8.383-5.316a.25.25 0 0 0 0-.422l-8.383-5.316z"/><path fill-rule="evenodd" d="M1.867 12.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/><path fill-rule="evenodd" d="M1.867 16.324a.75.75 0 0 1 1.035-.232l8.964 5.685a.25.25 0 0 0 .268 0l8.964-5.685a.75.75 0 0 1 .804 1.267l-8.965 5.685a1.75 1.75 0 0 1-1.874 0l-8.965-5.685a.75.75 0 0 1-.231-1.035z"/></svg>

    </a>
    IOTstack - UKKOPAHIS-fork
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ukkopahis/IOTstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ukkopahis/IOTstack
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Basic setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basic setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Basic setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Accessing-your-Device-from-the-internet/" class="md-nav__link">
        Accessing your device from the internet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Backup-and-Restore/" class="md-nav__link">
        Backing up and restoring IOTstack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Custom/" class="md-nav__link">
        Custom overrides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Default-Configs/" class="md-nav__link">
        Default Passwords and ports
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Menu/" class="md-nav__link">
        Menu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/Understanding-Containers/" class="md-nav__link">
        What is Docker?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Basic_setup/What-is-sudo/" class="md-nav__link">
        What is sudo?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AdGuardHome/" class="md-nav__link">
        AdGuard Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Adminer/" class="md-nav__link">
        Adminer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Blynk_server/" class="md-nav__link">
        Blynk server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Chronograf/" class="md-nav__link">
        Chronograf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DashMachine/" class="md-nav__link">
        DashMachine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Deconz/" class="md-nav__link">
        deCONZ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DiyHue/" class="md-nav__link">
        DIY hue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Dozzle/" class="md-nav__link">
        Dozzle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Duckdns/" class="md-nav__link">
        Duck DNS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EspruinoHub/" class="md-nav__link">
        Espruinohub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Heimdall/" class="md-nav__link">
        Heimdall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Home-Assistant/" class="md-nav__link">
        Home Assistant
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Homebridge/" class="md-nav__link">
        Homebridge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Homer/" class="md-nav__link">
        Homer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../InfluxDB/" class="md-nav__link">
        InfluxDB
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          InfluxDB 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        InfluxDB 2
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology-database-vs-bucket" class="md-nav__link">
    terminology: database vs bucket
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-service-definition" class="md-nav__link">
    reference service definition
  </a>
  
    <nav class="md-nav" aria-label="reference service definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-edits" class="md-nav__link">
    required edits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-1-mode-specific-directives" class="md-nav__link">
    Table 1: mode-specific directives
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialising-influxdb-2" class="md-nav__link">
    initialising InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migration-procedure" class="md-nav__link">
    data-migration procedure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-influxdb-2" class="md-nav__link">
    running InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-initialising-influxdb-2" class="md-nav__link">
    re-initialising InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-influxdb-2-data" class="md-nav__link">
    exploring InfluxDB 2 data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flux-queries-via-point-and-click" class="md-nav__link">
    Flux queries via point-and-click
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-adapting-node-red" class="md-nav__link">
    example: adapting Node-RED
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-adapting-grafana" class="md-nav__link">
    example: adapting Grafana
  </a>
  
    <nav class="md-nav" aria-label="example: adapting Grafana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-an-influxdb-2-data-source" class="md-nav__link">
    defining an InfluxDB 2 data source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-an-influxdb-2-data-source-in-a-dashboard" class="md-nav__link">
    using an InfluxDB 2 data source in a dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odds-and-ends" class="md-nav__link">
    odds and ends
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-strategy" class="md-nav__link">
    migration strategy
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kapacitor/" class="md-nav__link">
        Kapacitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MariaDB/" class="md-nav__link">
        MariaDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Mosquitto/" class="md-nav__link">
        Mosquitto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MotionEye/" class="md-nav__link">
        MotionEye
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../NextCloud/" class="md-nav__link">
        Nextcloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Node-RED/" class="md-nav__link">
        Node-RED
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Octoprint/" class="md-nav__link">
        Octoprint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../OpenHab/" class="md-nav__link">
        openHAB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Pi-hole/" class="md-nav__link">
        Pi-hole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Plex/" class="md-nav__link">
        Plex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Portainer-agent/" class="md-nav__link">
        Portainer agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Portainer-ce/" class="md-nav__link">
        Portainer CE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../PostgreSQL/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../RTL_433-docker/" class="md-nav__link">
        RTL_433 Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Syncthing/" class="md-nav__link">
        Syncthing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TasmoAdmin/" class="md-nav__link">
        TasmoAdmin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Telegraf/" class="md-nav__link">
        Telegraf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Timescaledb/" class="md-nav__link">
        Timescaledb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../WireGuard/" class="md-nav__link">
        WireGuard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../X2go/" class="md-nav__link">
        x2go
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Zigbee2MQTT/" class="md-nav__link">
        Zigbee2MQTT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Zigbee2mqttassistant/" class="md-nav__link">
        Zigbee2Mqtt Assistant
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/BuildStack-RandomPassword/" class="md-nav__link">
        Build Stack Random Services Password
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/BuildStack-Services/" class="md-nav__link">
        Build Stack Services system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/Git-Setup/" class="md-nav__link">
        Git Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/Menu-System/" class="md-nav__link">
        Menu system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Developers/PostBuild-Script/" class="md-nav__link">
        Postbuild BASH Script
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Updates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Updates" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Updates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/" class="md-nav__link">
        Updating the project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/Changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/New-Menu-Release-Notes/" class="md-nav__link">
        New IOTstack Menu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/gcgarner-migration/" class="md-nav__link">
        Migrating from gcgarner to SensorsIot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/migration-network-change/" class="md-nav__link">
        Migration: network change
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology-database-vs-bucket" class="md-nav__link">
    terminology: database vs bucket
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-service-definition" class="md-nav__link">
    reference service definition
  </a>
  
    <nav class="md-nav" aria-label="reference service definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-edits" class="md-nav__link">
    required edits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-1-mode-specific-directives" class="md-nav__link">
    Table 1: mode-specific directives
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialising-influxdb-2" class="md-nav__link">
    initialising InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migration-procedure" class="md-nav__link">
    data-migration procedure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-influxdb-2" class="md-nav__link">
    running InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-initialising-influxdb-2" class="md-nav__link">
    re-initialising InfluxDB 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-influxdb-2-data" class="md-nav__link">
    exploring InfluxDB 2 data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flux-queries-via-point-and-click" class="md-nav__link">
    Flux queries via point-and-click
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-adapting-node-red" class="md-nav__link">
    example: adapting Node-RED
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-adapting-grafana" class="md-nav__link">
    example: adapting Grafana
  </a>
  
    <nav class="md-nav" aria-label="example: adapting Grafana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-an-influxdb-2-data-source" class="md-nav__link">
    defining an InfluxDB 2 data source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-an-influxdb-2-data-source-in-a-dashboard" class="md-nav__link">
    using an InfluxDB 2 data source in a dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odds-and-ends" class="md-nav__link">
    odds and ends
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-strategy" class="md-nav__link">
    migration strategy
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ukkopahis/IOTstack/edit/master/docs/Containers/InfluxDB2.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="influxdb-2">InfluxDB 2<a class="headerlink" href="#influxdb-2" title="Permanent link">&para;</a></h1>
<h2 id="references">references<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.influxdata.com">InfluxData home page</a></li>
<li><a href="https://hub.docker.com/_/influxdb">DockerHub</a></li>
<li><a href="https://github.com/influxdata/influxdata-docker">GitHub</a></li>
</ul>
<h2 id="assumptions"><a name="keyAssumptions"></a>assumptions<a class="headerlink" href="#assumptions" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Your Raspberry Pi is running <strong>full</strong> 64-bit Raspberry Pi OS Debian GNU/Linux 11 (bullseye).</p>
<ul>
<li>DockerHub does not have a 32-bit image for InfluxDB&nbsp;2 so you can't run this container until you have upgraded.</li>
<li>Running full 64-bit is <strong>not</strong> the same as enabling the 64-bit kernel in <code>/boot/config.txt</code>. User-mode needs to be 64-bit capable as well. You must start from a <a href="https://www.raspberrypi.com/software/operating-systems/#raspberry-pi-os-64-bit">full 64-bit image</a>.</li>
</ul>
</li>
<li>
<p>Node-RED is your principal mechanism for feeding data to InfluxDB&nbsp;1.8.</p>
<ul>
<li>You may have other services feeding data to InfluxDB&nbsp;1.8 (eg Telegraf). The steps documented here will migrate all your existing data but do not discuss how to adapt services other than Node-RED to feed new data to InfluxDB&nbsp;2.</li>
</ul>
</li>
<li>
<p>Grafana is your principle mechanism for creating dashboards based on data stored in InfluxDB&nbsp;1.8.</p>
<ul>
<li>You may have other visualisation tools. You may gain insights from studying how Grafana needs to be changed to run Flux queries against InfluxDB&nbsp;2 buckets but this documentation does not explore alternatives.</li>
</ul>
</li>
<li>
<p>Node-RED, InfluxDB&nbsp;1.8 and Grafana are all running in <em>non-host</em> mode on the same Docker instance, and that it is your intention to deploy InfluxDB&nbsp;2 in <em>non-host</em> mode as well.</p>
<ul>
<li>If you are running any containers in <em>host</em> mode or have distributed the services across multiple Docker instances, you will have to adapt appropriately.</li>
</ul>
</li>
</ol>
<h2 id="terminology-database-vs-bucket">terminology: <em>database</em> vs <em>bucket</em><a class="headerlink" href="#terminology-database-vs-bucket" title="Permanent link">&para;</a></h2>
<p>InfluxDB&nbsp;1.8 and InfluxDB&nbsp;2 are both database management systems (DBMS), sometimes referred to as "engines", optimised for storage and retrieval of time-series data. InfluxDB&nbsp;1.8 uses the term <em>database</em> to mean a collection of <em>measurements</em>. InfluxDB&nbsp;2 uses the term <em>bucket</em> to mean the same thing.</p>
<p>When an InfluxDB&nbsp;1.8 <em>database</em> is migrated, it becomes an InfluxDB&nbsp;2 <em>bucket</em>. You will see this change in terminology in various places, such as the InfluxDB-out node in Node-RED. When that node is set to:</p>
<ul>
<li>
<p>Version 1.x, the user interface has a "Database" field which travels with the <em>connection</em>. For example:</p>
<ul>
<li><kbd>[v1.x] influxdb:8086/power</kbd> (set up in the connection sheet)</li>
</ul>
<p>This implies that you need one <em>connection</em> per <em>database</em>.</p>
</li>
<li>
<p>Version 2.0, the user interface has a "Bucket" field which is independent of the connection. For example:</p>
<ul>
<li><kbd>[v2.0] influxdb:8086</kbd> (set up in the connection sheet)</li>
<li><kbd>Bucket</kbd><kbd>power/autogen</kbd> (set up in the node)</li>
</ul>
<p>This implies that you need one <em>connection</em> per <em>engine</em>. It is a subtle but important difference.</p>
</li>
</ul>
<h2 id="reference-service-definition"><a name="svcDef"></a>reference service definition<a class="headerlink" href="#reference-service-definition" title="Permanent link">&para;</a></h2>
<p>The InfluxDB&nbsp;2 service definition is added to your compose file by the IOTstack menu.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">influxdb2</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb2</span><span class="w"></span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;influxdb:latest&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span><span class="w"></span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=Etc/UTC</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_USERNAME=me</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_PASSWORD=mypassword</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_ORG=myorg</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_BUCKET=mybucket</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-auth-token</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8087:8086&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/influxdb2/data:/var/lib/influxdb2</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/influxdb2/config:/etc/influxdb2</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/influxdb2/backup:/var/lib/backup</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - ./volumes/influxdb.migrate/data:/var/lib/influxdb:ro</span><span class="w"></span>
<span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;influx&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class="w"></span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span><span class="w"></span>
<span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">    </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>As an alternative to using the menu, you can copy and paste the service definition into your compose file from the template at:</p>
<div class="language-text highlight"><pre><span></span><code>~/IOTstack/.templates/influxdb2/service.yml
</code></pre></div>
<h3 id="required-edits"><a name="svcDefEdits"></a>required edits<a class="headerlink" href="#required-edits" title="Permanent link">&para;</a></h3>
<p>Edit the service definition in your compose file to change the following variables:</p>
<ul>
<li>
<p><code>TZ=</code>«country»/«city»</p>
</li>
<li>
<p><a name="influxUsername"></a><code>DOCKER_INFLUXDB_INIT_USERNAME=</code>«username»</p>
<p>This name becomes the administrative user. It is associated with your <a href="#influxPassword">«password»</a> and <a href="#influxToken">«token»</a>.</p>
</li>
<li>
<p><a name="influxPassword"></a><code>DOCKER_INFLUXDB_INIT_PASSWORD=</code>«password»</p>
<p>Your «username» and «password» form your login credentials when you administer InfluxDB&nbsp;2 using its web-based graphical user interface. The strength of your password is up to you.</p>
</li>
<li>
<p><a name="influxOrg"></a><code>DOCKER_INFLUXDB_INIT_ORG=</code>«organisation»</p>
<p>An organisation name is <strong>required</strong>. Examples:</p>
<ul>
<li>myorg</li>
<li>my-house</li>
<li>com.mydomain.myhouse</li>
</ul>
</li>
<li>
<p><a name="influxBucket"></a><code>DOCKER_INFLUXDB_INIT_BUCKET=</code>«bucket»</p>
<p>A default bucket name is <strong>required</strong>. The name does not matter because you won't actually be using it so you can accept the default of "mybucket". You can <a href="#delBucket">delete the unused bucket</a> later if you want to be tidy.</p>
</li>
<li>
<p><a name="influxToken"></a><code>DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=</code>«token»</p>
<p>Although you can let InfluxDB&nbsp;2 generate your access token for you, it will keep things simple if you generate your own. Here are some possible approaches:</p>
<ol>
<li>
<p>use a universally-unique ID:</p>
<div class="language-bash highlight"><pre><span></span><code>$ uuidgen
4fef85b4-2f56-480f-b143-fa5cb6e8f18a
</code></pre></div>
</li>
<li>
<p>use GnuPG to generate a random string:</p>
<div class="language-bash highlight"><pre><span></span><code>$ gpg --gen-random -a <span class="m">0</span> <span class="m">25</span>
<span class="nv">bYS3EsnnY0AlRxJ2uk44Hzwm7GMKYu5unw</span><span class="o">==</span>
</code></pre></div>
</li>
<li>
<p>use a password-generator of your choosing.</p>
</li>
</ol>
</li>
</ul>
<p>Note:</p>
<ul>
<li>Unless a container's documentation explicitly states that it is supported, you should never use quote marks to encapsulate the values you supply via environment variables. InfluxDB&nbsp;2 treats quotes as being part of the value (eg a password of "fred" is the 6-character string that <em>includes</em> the quotes). If you put quote marks around anything as you were editing, please go back and remove them.</li>
</ul>
<h3 id="table-1-mode-specific-directives"><a name="svcDefVars"></a>Table 1: mode-specific directives<a class="headerlink" href="#table-1-mode-specific-directives" title="Permanent link">&para;</a></h3>
<p>InfluxDB 2 operates in three distinct modes which are controlled by the <code>DOCKER_INFLUXDB_INIT_MODE</code> environment variable. The table below summarises the variables and volumes mappings that need to be active in each mode.</p>
<p><img alt="Table 1" src="../images/influxdb2-table1.png" /></p>
<h2 id="initialising-influxdb-2"><a name="initContainer"></a>initialising InfluxDB 2<a class="headerlink" href="#initialising-influxdb-2" title="Permanent link">&para;</a></h2>
<p>If you have only just included the <a href="#svcDef">template service definition</a> in your compose file and performed the <a href="#svcDefEdits">required edits</a>, then you can follow the initialisation process below.</p>
<p>However, if you want to <strong>re-initialise</strong> the container, go to <a href="#reinitContainer">re-initialising InfluxDB&nbsp;2</a>.</p>
<p>To initialise InfluxDB&nbsp;2:</p>
<ol>
<li>Confirm that the service definition directives are set as per the "setup" column of <a href="#svcDefVars">Table 1</a>. </li>
<li>
<p>Be in the correct directory (assumed throughout):</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
</code></pre></div>
</li>
<li>
<p>Start the InfluxDB&nbsp;2 container:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker-compose up -d influxdb2
</code></pre></div>
</li>
<li>
<p>InfluxDB&nbsp;2 will notice the following environment variable:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
</code></pre></div>
<p>This instructs the container to initialise the database engine structures based on a combination of defaults and the values you provide via the other environment variables.</p>
</li>
<li>
<p>Confirm that the InfluxDB&nbsp;2 container is not in a restart loop and isn't reporting errors by using commands like:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker ps
$ docker logs influxdb2
</code></pre></div>
</li>
</ol>
<p>If you don't need to migrate any data from InfluxDB&nbsp;1.8 you can go straight to <a href="#runContainer">running InfluxDB&nbsp;2</a>, otherwise follow the <a href="#migrateContainer">data-migration procedure</a> instructions below.</p>
<h2 id="data-migration-procedure"><a name="migrateContainer"></a>data-migration procedure<a class="headerlink" href="#data-migration-procedure" title="Permanent link">&para;</a></h2>
<p>Successful migration depends on the following assumptions being true:</p>
<ul>
<li>The InfluxDB&nbsp;2 container is running and has just been initialised as per <a href="#initContainer">initialising InfluxDB&nbsp;2</a>.</li>
<li>
<p>The InfluxDB&nbsp;1.8 container is running, and is based on the IOTstack service definition (or reasonable facsimile) at:</p>
<div class="language-text highlight"><pre><span></span><code>~/IOTstack/.templates/influxdb/service.yml
</code></pre></div>
</li>
</ul>
<p>To migrate your InfluxDB&nbsp;1.8 data:</p>
<ol>
<li>
<p>Be in the correct directory (assumed throughout):</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
</code></pre></div>
</li>
<li>
<p>InfluxDB&nbsp;1.8 runs as root and its persistent store is owned by root but not all files and folders in the persistent store are <em>group</em> or <em>world</em> readable. InfluxDB&nbsp;2 runs as user ID 1000 (user "influxdb" inside the container). Because of this, you need to give InfluxDB&nbsp;2 permission to read the InfluxDB&nbsp;1.8 persistent store.</p>
<p>It is not a good idea to interfere with a persistent store while a container is running so best practice is to stop InfluxDB&nbsp;1.8 for long enough to make a copy of its persistent store:</p>
<div class="language-bash highlight"><pre><span></span><code>$ sudo rm -rf ./volumes/influxdb.migrate
$ docker-compose rm --force --stop -v influxdb
$ sudo cp -a ./volumes/influxdb ./volumes/influxdb.migrate
$ docker-compose up -d influxdb
$ sudo chown -R <span class="m">1000</span>:1000 ./volumes/influxdb.migrate/data
</code></pre></div>
<p>In words:</p>
<ol>
<li>Ensure any previous attempts at migration are removed. Always be <em>extremely</em> careful with any <code>sudo rm</code> command. Check your work <strong>before</strong> you press <kbd>return</kbd>.</li>
<li>Stop InfluxDB&nbsp;1.8.</li>
<li>Make a copy of the InfluxDB&nbsp;1.8 persistent store.</li>
<li>Start InfluxDB&nbsp;1.8 again.</li>
<li>Change ownership of the <strong>copy</strong> of the InfluxDB&nbsp;1.8 persistent store.</li>
</ol>
</li>
<li>
<p>Edit your compose file as per the "upgrade" column of <a href="#svcDefVars">Table 1</a>. The changes you need to make are:</p>
<ol>
<li>
<p>Change the initialisation mode from <code>setup</code> to <code>upgrade</code>:</p>
<ul>
<li>
<p>before editing:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>after editing:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
</li>
<li>
<p>Activate the volume mapping to give InfluxDB&nbsp;2 read-only access to the <strong>copy</strong> of the InfluxDB&nbsp;1.8 persistent store that you made in step 2:</p>
<ul>
<li>
<p>before editing:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># - ./volumes/influxdb.migrate/data:/var/lib/influxdb:ro</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>after editing:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./volumes/influxdb.migrate/data:/var/lib/influxdb:ro</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
</li>
</ol>
<p>Save your work but do not execute any <code>docker-compose</code> commands.</p>
</li>
<li>
<p>InfluxDB&nbsp;2 creates a "bolt" (lock) file to prevent accidental data-migrations. That file needs to be removed:</p>
<div class="language-bash highlight"><pre><span></span><code>$ rm ./volumes/influxdb2/data/influxd.bolt
</code></pre></div>
</li>
<li>
<p>The InfluxDB&nbsp;2 container is still running. The following command causes the container to be recreated with the edits you made in step 3:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker-compose up -d influxdb2
</code></pre></div>
</li>
<li>
<p>InfluxDB&nbsp;2 will notice the following environment variable:</p>
<div class="language-yaml highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
</code></pre></div>
<p>This, combined with the absence of the "bolt" file, starts the migration process. You need to wait until the migration is complete. The simplest way to do that is to watch the size of the persistent store for InfluxDB&nbsp;2 until it stops increasing. Experience suggests that the InfluxDB&nbsp;2 persistent store will usually be a bit larger than InfluxDB&nbsp;1.8. For example:</p>
<ul>
<li>
<p>reference size for an InfluxDB&nbsp;1.8 installation:</p>
<div class="language-bash highlight"><pre><span></span><code>$ sudo du -sh ./volumes/influxdb
633M    ./volumes/influxdb
</code></pre></div>
</li>
<li>
<p>final size after migration to InfluxDB&nbsp;2:</p>
<div class="language-bash highlight"><pre><span></span><code>$ sudo du -sh ./volumes/influxdb2
721M    ./volumes/influxdb2
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Data migration is complete once the folder size stops changing.</p>
</li>
</ol>
<p>Proceed to <a href="#runContainer">running InfluxDB&nbsp;2</a> below.</p>
<h2 id="running-influxdb-2"><a name="runContainer"></a>running InfluxDB 2<a class="headerlink" href="#running-influxdb-2" title="Permanent link">&para;</a></h2>
<p>The container now needs to be instructed to run in normal mode.</p>
<ol>
<li>
<p>Be in the correct directory (assumed throughout):</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
</code></pre></div>
</li>
<li>
<p>Edit your compose file as per the "(omitted)" column of <a href="#svcDefVars">Table 1</a>. The changes are:</p>
<ol>
<li>
<p>Deactivate all <code>DOCKER_INFLUXDB_INIT_</code> environment variables. After editing, the relevant lines should look like:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_USERNAME=me</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_PASSWORD=mypassword</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_ORG=myorg</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_BUCKET=mybucket</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-auth-token</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Deactivate the volume mapping if it is active. After editing, the line should look like:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># - ./volumes/influxdb.migrate/data:/var/lib/influxdb:ro</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>Save your work.</p>
</li>
<li>
<p>The InfluxDB&nbsp;2 container is still running. The following command causes the container to be recreated with the edits you have just made:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker-compose up -d influxdb2
</code></pre></div>
<p>The absence of an active <code>DOCKER_INFLUXDB_INIT_MODE</code> variable places InfluxDB&nbsp;2 into normal run mode.</p>
</li>
<li>
<p>If you have just performed a data migration, you can remove the <strong>copy</strong> of the InfluxDB&nbsp;1.8 persistent store:</p>
<div class="language-bash highlight"><pre><span></span><code>$ sudo rm -rf ./volumes/influxdb.migrate
</code></pre></div>
<blockquote>
<p>always be <em>extremely</em> careful with any <code>sudo rm</code> command. Always check your work <strong>before</strong> you press <kbd>return</kbd>.</p>
</blockquote>
</li>
</ol>
<h2 id="re-initialising-influxdb-2"><a name="reinitContainer"></a>re-initialising InfluxDB 2<a class="headerlink" href="#re-initialising-influxdb-2" title="Permanent link">&para;</a></h2>
<p>If you need to start over from a clean slate:</p>
<ol>
<li>
<p>Be in the correct directory (assumed throughout):</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
</code></pre></div>
</li>
<li>
<p>Terminate the InfluxDB&nbsp;2 container:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker-compose rm --force --stop -v influxdb2
</code></pre></div>
</li>
<li>
<p>Remove the persistent store:</p>
<div class="language-bash highlight"><pre><span></span><code>$ sudo rm -rf ./volumes/influxdb2
</code></pre></div>
<blockquote>
<p>always be <em>extremely</em> careful with any <code>sudo rm</code> command. Always check your work <strong>before</strong> you press <kbd>return</kbd>.</p>
</blockquote>
</li>
<li>
<p>Edit your compose file as per the "setup" column of <a href="#svcDefVars">Table 1</a>. After editing, the relevant lines should look like this:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_USERNAME=me</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_PASSWORD=mypassword</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_ORG=myorg</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_BUCKET=mybucket</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-auth-token</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_INFLUXDB_INIT_MODE=setup</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - DOCKER_INFLUXDB_INIT_MODE=upgrade</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p>Go to <a href="#initContainer">initialising InfluxDB&nbsp;2</a>.</p>
<h2 id="exploring-influxdb-2-data">exploring InfluxDB 2 data<a class="headerlink" href="#exploring-influxdb-2-data" title="Permanent link">&para;</a></h2>
<p><img alt="browse data" src="../images/influxdb2-explorer.jpeg" /></p>
<ol>
<li>
<p>Launch a browser and connect it to port 8087 on your Raspberry Pi. For example:</p>
<div class="language-text highlight"><pre><span></span><code>http://raspberrypi.local:8087
</code></pre></div>
<p>You can also use the IP address or domain name of your Raspberry Pi. In this context, 8087 is the <em>external</em> port number from the left hand side of the port mapping in the service definition:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8087:8086&quot;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Sign in to the InfluxDB&nbsp;2 instance using your <a href="#influxUsername">«username»</a> and <a href="#influxPassword">«password»</a>.</p>
</li>
<li>
<p>Click on "Explore" in the left-hand tool strip. That is marked [A] in the screen shot. In the area marked [B] you should be able to see a list of the <em>buckets</em> that were migrated from InfluxDB&nbsp;1.8 <em>databases</em>.</p>
<p>In the screen shot, I clicked on other fields to create a query:</p>
<ul>
<li>In area <a name="influxExplorer-B"></a>[B], I selected the "power/autogen" <em>bucket</em>;</li>
<li>In area <a name="influxExplorer-C"></a>[C], I selected the "hiking2" (electricity meter) <em>measurement</em>;</li>
<li>In area <a name="influxExplorer-D"></a>[D], I selected the "voltage" <em>field</em>;</li>
<li>The bucket in this test is a migrated copy of an InfluxDB&nbsp;1.8 database. It was not ingesting live data so I also needed to change the duration popup menu [E] to a time-span that included the most-recent insertions;</li>
<li>Then I clicked the "Submit" button [F]; and</li>
<li>The result was the graph in [G].</li>
</ul>
</li>
</ol>
<p>You can explore your own tables using similar techniques.</p>
<h2 id="flux-queries-via-point-and-click">Flux queries via point-and-click<a class="headerlink" href="#flux-queries-via-point-and-click" title="Permanent link">&para;</a></h2>
<p>Grafana does not (yet) seem to have the ability to let you build Flux queries via point-and-click like you can with InfluxQL queries. Until Grafana gains that ability, it's probably a good idea to learn how to build Flux queries in InfluxDB, so you can copy-and-paste the Flux statements into Grafana.</p>
<p>Once you have constructed a query in the "Query Builder", click the "Script Editor" button [H] to switch to the editor view. </p>
<p>For this example, the <a name="queryText"></a>query text is:</p>
<div class="language-text highlight"><pre><span></span><code>from(bucket: &quot;power/autogen&quot;)
  |&gt; range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |&gt; filter(fn: (r) =&gt; r[&quot;_measurement&quot;] == &quot;hiking2&quot;)
  |&gt; filter(fn: (r) =&gt; r[&quot;_field&quot;] == &quot;voltage&quot;)
  |&gt; aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)
  |&gt; yield(name: &quot;mean&quot;)
</code></pre></div>
<p>Two important things to note here are:</p>
<ol>
<li>The <a name="bucketName"></a><em>bucket</em> name: <code>power/autogen</code>; and</li>
<li>The <a name="measurementName"></a><em>measurement</em> name: <code>hiking2</code>.</li>
</ol>
<h2 id="example-adapting-node-red">example: adapting Node-RED<a class="headerlink" href="#example-adapting-node-red" title="Permanent link">&para;</a></h2>
<p><img alt="Node-RED flow models" src="../images/influxdb2-nodered-flow-models.jpeg" /></p>
<ol>
<li>
<p>Assume you have an existing flow (eg a fairly standard <a href="https://gist.github.com/Paraphraser/c9db25d131dd4c09848ffb353b69038f">3-node flow</a>) which is logging to an InfluxDB&nbsp;1.8 database. Your goal is to modify the flow to log the same data to the recently-migrated InfluxDB&nbsp;2 bucket. </p>
</li>
<li>
<p>Start Node-RED if it is not running:</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
$ docker-compose up -d nodered
</code></pre></div>
</li>
<li>
<p>Use a web browser to connect to your Node-RED instance.</p>
</li>
<li>
<p>Drag a <strong>new</strong> InfluxDB-out node onto the canvas:</p>
<ul>
<li>This is exactly the same InfluxDB-out node that you have been using to write to your InfluxDB&nbsp;1.8 databases. There isn't a different node or package for InfluxDB&nbsp;2.</li>
<li>Always drag a <strong>new</strong> InfluxDB-out node from the palette onto the canvas. Do not make the mistake of re-using an existing InfluxDB-out node (eg via copy and paste) because that is a very good way of breaking your flows.</li>
</ul>
</li>
<li>
<p>Double-click the InfluxDB-out node to open it:</p>
<p><img alt="InfluxDB-out node" src="../images/influxdb2-nodered-db-out-node.jpeg" /></p>
<ul>
<li>At [A], give the node a sensible name.</li>
<li>
<p>Click the pencil icon [B] adjacent to the Server field:</p>
<ul>
<li>Leave the Name field [C] blank. This ensures that the title in the popup menu [D] automatically reflects the version and connection URL.</li>
<li>Change the Version popup menu [E] to "2.0". </li>
<li>
<p>Set the URL [F] to point to your InfluxDB&nbsp;2 instance:</p>
<div class="language-text highlight"><pre><span></span><code>http://influxdb2:8086
</code></pre></div>
<blockquote>
<p>In this context, "influxdb2" is the container name and 8086 is the container's <em>internal</em> port. Node-RED communicates with InfluxDB&nbsp;2 across the internal bridged network (see <a href="#keyAssumptions">assumptions</a>).</p>
</blockquote>
</li>
<li>
<p>Paste your <a href="#influxToken">«token»</a> into the Token field [G].</p>
</li>
<li>Click "Update" [H].</li>
</ul>
</li>
<li>
<p>Set the Organisation field [I] to your <a href="#influxOrg">«organisation»</a>.</p>
</li>
<li>
<p>Set the Bucket [J] to the correct value. You can get that from either:</p>
<ul>
<li>area <a href="#influxExplorer-B">[B]</a> in the Influx Explorer screen shot; or</li>
<li>the <a href="#bucketName">bucket name</a> from the saved Flux query.</li>
</ul>
<p>In this example, the bucket name is "power/autogen".</p>
</li>
<li>
<p>Set the Measurement [K] to the measurement name. You can get that from either:</p>
<ul>
<li>area <a href="#influxExplorer-C">[C]</a> in the Influx Explorer screen shot; or</li>
<li>the <a href="#measurementName">measurement name </a> from the saved Flux query.</li>
</ul>
<p>In this example, the measurement name is "hiking2".</p>
</li>
<li>
<p>Click Done [L].</p>
</li>
</ul>
</li>
<li>
<p>Connect the outlet of the Change node to the inlet of the InfluxDB-out node.</p>
</li>
<li>Click Deploy.</li>
<li>Watch the debug panel to make sure no errors are being reported.</li>
<li>
<p>Go back to the InfluxDB&nbsp;2 Data Explorer and click the refresh button "I". If everything has gone according to plan, you should see recent observations added to your graph. </p>
<blockquote>
<p>You may need to wait until your sensor has sent new data.</p>
</blockquote>
</li>
</ol>
<h2 id="example-adapting-grafana">example: adapting Grafana<a class="headerlink" href="#example-adapting-grafana" title="Permanent link">&para;</a></h2>
<h3 id="defining-an-influxdb-2-data-source">defining an InfluxDB 2 data source<a class="headerlink" href="#defining-an-influxdb-2-data-source" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start Grafana if it is not running:</p>
<div class="language-bash highlight"><pre><span></span><code>$ <span class="nb">cd</span> ~/IOTstack
$ docker-compose up -d grafana
</code></pre></div>
</li>
<li>
<p>Use a web browser to connect to your Grafana instance and login as an administrator.</p>
</li>
<li>Hover your mouse over the "gear" icon in the tool-strip on the left hand side, and choose "Data sources".</li>
<li>Click the "Add data source" button.</li>
<li>Select the "InfluxDB" option.</li>
<li>
<p>Configure as follows:</p>
<p><img alt="Grafana config DB source" src="../images/influxdb2-grafana-db-source.jpeg" /></p>
<ul>
<li>Change the Name [A] to a <a name="bucketConnection"></a> meaningful title that reflects the <strong>bucket</strong> you are going to query. For example, "InfluxDB&nbsp;2.0 power".</li>
<li>
<p>Change the Query Language popup menu [B] to "Flux".</p>
<blockquote>
<p>Ignore the advice about Flux support being in beta.</p>
</blockquote>
</li>
<li>
<p>Change the URL [C] to point to your InfluxDB&nbsp;2 instance:</p>
<div class="language-text highlight"><pre><span></span><code>http://influxdb2:8086
</code></pre></div>
<blockquote>
<p>In this context, "influxdb2" is the container name and 8086 is the container's <em>internal</em> port. Grafana communicates with InfluxDB&nbsp;2 across the internal bridged network (see <a href="#keyAssumptions">assumptions</a>).</p>
</blockquote>
</li>
<li>
<p>Turn off all the switches in the "Auth" group [D].</p>
</li>
<li>Set the Organisation [E] to your <a href="#influxOrg">«organisation»</a>.</li>
<li>
<p>Paste your <a href="#influxToken">«token»</a> into the Token field [F].</p>
<blockquote>
<p>ignore the fact that the prompt text says "password" - you need the token!</p>
</blockquote>
</li>
<li>
<p>Set the Default Bucket [G] to the bucket (database) you want to query. You can get that from either:</p>
<ul>
<li>area <a href="#influxExplorer-B">[B]</a> in the Influx Explorer screen shot; or</li>
<li>the <a href="#bucketName">bucket name</a> from the saved Flux query.</li>
</ul>
<p>In this example, the value is "power/autogen".</p>
</li>
<li>
<p>Click Save &amp; Test [H].</p>
</li>
</ul>
</li>
</ol>
<h3 id="using-an-influxdb-2-data-source-in-a-dashboard">using an InfluxDB 2 data source in a dashboard<a class="headerlink" href="#using-an-influxdb-2-data-source-in-a-dashboard" title="Permanent link">&para;</a></h3>
<ol>
<li>Find the + icon in the tool-strip on the left hand side, hover your mouse over it and choose "Create » dashboard".</li>
<li>Click "Add a new panel".</li>
<li>Change the "Data source" popup to the <a href="#bucketConnection">bucket connection</a> you created earlier ("InfluxDB&nbsp;2.2 power").</li>
<li>The editor automatically switches into Flux mode.</li>
<li>Paste the <a href="#queryText">query text</a> you saved earlier from the InfluxDB&nbsp;2 query inspector.</li>
<li>If necessary, change the duration to a period that is likely to contain some data to display.</li>
<li>Click the Refresh button.</li>
<li>Click Apply.</li>
</ol>
<p>In the side-by-side screen shots below, observations before the straight-line (missing data) segment were imported from InfluxDB&nbsp;1.8 while observations after the straight-line segment were inserted by the new InfluxDB-out node in Node-RED.</p>
<p><img alt="compare results" src="../images/influxdb2-chart-vs-grafana.jpeg" /></p>
<h2 id="odds-and-ends">odds and ends<a class="headerlink" href="#odds-and-ends" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Forgot your token:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker <span class="nb">exec</span> influxdb2 influx auth ls
</code></pre></div>
</li>
<li>
<p>Create a new user, password and token:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker <span class="nb">exec</span> influxdb2 influx user create --name «username» --password «password»
$ docker <span class="nb">exec</span> influxdb2 influx auth create --user «username» --all-access
</code></pre></div>
</li>
<li>
<p>List available buckets:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker <span class="nb">exec</span> influxdb2 influx bucket ls
</code></pre></div>
</li>
<li>
<p><a name="delBucket"></a>Delete the <a href="#influxBucket">default «bucket»</a>:</p>
<div class="language-bash highlight"><pre><span></span><code>$ docker <span class="nb">exec</span> influxdb2 influx bucket delete --org «organisation» --name «bucket»
</code></pre></div>
</li>
</ol>
<h2 id="migration-strategy">migration strategy<a class="headerlink" href="#migration-strategy" title="Permanent link">&para;</a></h2>
<p>From the fact that both InfluxDB&nbsp;1.8 and InfluxDB&nbsp;2 can run in parallel, with Node-RED feeding the same data to both, it should be self-evident that you can repeat the data-migration as often as necessary, simply by starting from <a href="#reinitContainer">re-initialising InfluxDB&nbsp;2</a>.</p>
<p>This implies that you can concentrate on one database at a time, adjusting Node-RED so that it writes each row of sensor data to both the InfluxDB&nbsp;1.8 database and corresponding InfluxDB&nbsp;2 bucket.</p>
<p>Having the data going to both engines means you can take your time adjusting your Grafana dashboards to be based on Flux queries. You can either retrofit InfluxDB&nbsp;2 bucket sources and Flux queries to existing dashboards, or build parallel dashboards from the ground up.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../InfluxDB/" class="md-footer__link md-footer__link--prev" aria-label="Previous: InfluxDB" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              InfluxDB
            </div>
          </div>
        </a>
      
      
        
        <a href="../Kapacitor/" class="md-footer__link md-footer__link--next" aria-label="Next: Kapacitor" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Kapacitor
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "tabs", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="../../javascript/fix-codeblock-console-copy-button.js"></script>
      
    
  </body>
</html>